<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Second Life Shopping Tracker ‚Äî TEST</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Suppress Tailwind production warning
        window.tailwindConfig = { devMode: false };
    </script>
        <!-- Firebase modular SDK + cloudStorage (modular SDK). Replace config below if you prefer a different project. -->
        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
            import { getAuth, signInAnonymously, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, linkWithPopup, signOut } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
            import { getFirestore, enableIndexedDbPersistence, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

            // Your web app's Firebase configuration (from your Firebase Console)
            // NOTE: To enable Google Sign-in, go to Firebase Console ‚Üí Authentication ‚Üí Sign-in method ‚Üí Google ‚Üí enable.
            // After enabling, users can sign in and their data will be linked to their Google account.
            const firebaseConfig = {
                apiKey: "AIzaSyCjXLoLBGXwAY0EXPI0QrhMBUd4ic36nII",
                authDomain: "sl-shopping-tracker.firebaseapp.com",
                projectId: "sl-shopping-tracker",
                storageBucket: "sl-shopping-tracker.firebasestorage.app",
                messagingSenderId: "841243726764",
                appId: "1:841243726764:web:b7ad10ce99680359b02009"
            };

            const app = initializeApp(firebaseConfig);
            const auth = getAuth();
            const db = getFirestore();

            window.cloudStorage = {
                enabled: false,
                uid: null,
                docRef: null,
                unsubscribe: null,
                init: async function() {
                    try {
                        try { await enableIndexedDbPersistence(db); } catch (e) { console.warn('Firestore persistence:', e); }
                        await signInAnonymously(auth);
                        onAuthStateChanged(auth, async (user) => {
                            // Dispatch auth state for UI
                            const authPayload = user ? { uid: user.uid, isAnonymous: !!user.isAnonymous, displayName: user.displayName || null, email: user.email || null } : null;
                            window.dispatchEvent(new CustomEvent('auth-changed', { detail: authPayload }));
                            if (!user) return;
                            this.uid = user.uid;
                            this.docRef = doc(db, 'users', this.uid, 'meta', 'tracker');
                            this.unsubscribe = onSnapshot(this.docRef, (snap) => {
                                const data = snap.exists() ? snap.data() : {};
                                window.dispatchEvent(new CustomEvent('cloud-data', { detail: data }));
                            });
                            const snap = await getDoc(this.docRef);
                            if (snap.exists()) {
                                window.dispatchEvent(new CustomEvent('cloud-data', { detail: snap.data() }));
                            } else {
                                // If no cloud data yet, try importing localStorage to cloud for continuity
                                try {
                                    if (typeof localStorage !== 'undefined') {
                                        const saved = localStorage.getItem('sl-tracker-items');
                                        if (saved) {
                                            await setDoc(this.docRef, { items: JSON.parse(saved) }, { merge: true });
                                            window.dispatchEvent(new CustomEvent('cloud-data', { detail: { items: JSON.parse(saved) } }));
                                        }
                                    }
                                } catch (e) { console.warn('Error importing local data to cloud', e); }
                            }
                        });
                        this.enabled = true;
                    } catch (e) {
                        console.warn('cloudStorage init failed', e);
                    }
                },
                signInWithGoogle: async function() {
                    const provider = new GoogleAuthProvider();
                    try {
                        if (auth.currentUser && auth.currentUser.isAnonymous) {
                            // Link anonymous account to Google to preserve existing data
                            await linkWithPopup(auth.currentUser, provider);
                        } else {
                            await signInWithPopup(auth, provider);
                        }
                    } catch (e) {
                        console.error('Google sign-in failed', e);
                        throw e;
                    }
                },
                signOutUser: async function() {
                    try {
                        await signOut(auth);
                        // Re-establish anonymous session so app continues to work
                        await signInAnonymously(auth);
                    } catch (e) { console.warn('Sign out failed', e); }
                },
                getAll: async function() { if (!this.enabled || !this.docRef) return {}; const snap = await getDoc(this.docRef); return snap.exists() ? snap.data() : {}; },
                set: async function(key, value) { if (!this.enabled || !this.docRef) return; const payload = {}; payload[key] = value; await setDoc(this.docRef, payload, { merge: true }); }
            };

            // Initialize in background. If you prefer manual init, remove this line.
            window.cloudStorage.init().catch(e => console.warn('cloud init failed', e));
        </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600;700&family=Open+Sans:wght@400;600;700&display=swap');
        /* (rest of CSS is identical to the production file) */
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        /* (JSX and app logic is identical to production file) */

        function App() {
            /* Same state/logic as the production app */

            return (
                <div className="min-h-screen pb-8">
                    {/* Visible Test Banner */}
                    <div style={{background: '#ff4d4f', color: 'white', padding: '10px', textAlign: 'center', fontWeight: 700}}>TEST PAGE ‚Äî This is a temporary test copy. Do not overwrite your production site.</div>

                    {/* Header */}
                    <div className="sl-header text-white py-6 px-4 mb-6">
                        <div className="max-w-7xl mx-auto text-center relative">
                            <div style={{ position: 'absolute', right: '1rem', top: '1rem' }}>
                                {/* Sign-in UI is same as production */}
                                <button onClick={() => { if (window.cloudStorage && window.cloudStorage.signInWithGoogle) window.cloudStorage.signInWithGoogle(); else alert('Cloud auth not initialized'); }} className="px-3 py-1 rounded bg-white text-blue-700 font-semibold">Sign in with Google</button>
                                <div className="text-xs text-blue-100 mt-1">Sign in with Google to sync across your devices.</div>
                            </div>
                            <h1 
                                className="text-3xl md:text-4xl font-bold mb-2 flex items-center justify-center gap-3 cursor-pointer hover:opacity-80 transition"
                            >
                                <span>üõçÔ∏è</span>
                                <span>Second Life Shopping Tracker ‚Äî TEST</span>
                            </h1>
                            <p className="text-blue-100 text-lg mb-4">Track your wishlist, shopping & inventory! ‚ú® (TEST)</p>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-4">
                        <p className="text-sm text-gray-600 mb-6">This is a safe test page. Use it to verify Google sign-in and cloud sync before updating production.</p>
                        <!-- The rest of the UI is identical to production; for brevity the full JSX is unchanged -->
                    </div>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>